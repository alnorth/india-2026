---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getAllSlugs, getDayBySlug } from '@/lib/days';
import { format } from 'date-fns';
import GPXMap from '@/components/GPXMap';
import StravaEmbed from '@/components/StravaEmbed';
import PhotoGallery from '@/components/PhotoGallery';

export function getStaticPaths() {
  const slugs = getAllSlugs();
  return slugs.map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;
const day = getDayBySlug(slug);

if (!day) {
  return Astro.redirect('/404');
}
---

<BaseLayout title={`${day.title} - India 2026`}>
  <div>
    <a href="/" class="text-blue-600 hover:underline mb-4 inline-block">
      ‚Üê Back to all days
    </a>

    <article class="max-w-4xl">
      <header class="mb-8">
        <h1 class="text-4xl font-bold mb-2">{day.title}</h1>
        <div class="flex gap-4 text-gray-600 dark:text-gray-400">
          <time datetime={day.date}>
            {format(new Date(day.date), 'EEEE, MMMM d, yyyy')}
          </time>
          {day.distance && <span>{day.distance} km</span>}
          {day.location && <span>{day.location}</span>}
        </div>
        <span class={`inline-block mt-2 px-3 py-1 text-sm rounded ${
          day.status === 'completed' ? 'bg-green-100 text-green-800' :
          day.status === 'in-progress' ? 'bg-yellow-100 text-yellow-800' :
          'bg-gray-100 text-gray-800'
        }`}>
          {day.status}
        </span>
      </header>

      {day.gpxPath && (
        <section class="mb-8">
          <h2 class="text-2xl font-bold mb-4">Route</h2>
          <div class="h-96 rounded-lg overflow-hidden shadow-md">
            <GPXMap client:load gpxPath={day.gpxPath} />
          </div>
        </section>
      )}

      {day.stravaId && (
        <section class="mb-8">
          <h2 class="text-2xl font-bold mb-4">Ride Stats</h2>
          <StravaEmbed client:load activityId={day.stravaId} />
        </section>
      )}

      <section class="mb-8 prose dark:prose-invert max-w-none">
        <div set:html={day.content} />
      </section>

      {day.photos && day.photos.length > 0 && (
        <section class="mb-8">
          <h2 class="text-2xl font-bold mb-4">Photos</h2>
          <PhotoGallery client:load photos={day.photos} />
        </section>
      )}
    </article>
  </div>
</BaseLayout>
